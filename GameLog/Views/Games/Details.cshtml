@model GameLog.Models.GameDetailsViewModel

@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

<div>
    <h4>Game</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Game.Title)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Game.Title)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Game.ReleaseYear)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Game.ReleaseYear)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Game.CreatedAt)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Game.CreatedAt)
        </dd>
    </dl>
</div>
<div>
    <a asp-action="Edit" asp-route-id="@Model.Game.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>

<hr />

@if (User.Identity?.IsAuthenticated == true)
{
    <hr />
    <h4>Add to My List</h4>

    <form asp-controller="UserGameLists" asp-action="Upsert" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="gameId" value="@Model.Game.Id" />

        <div class="form-group">
            <label>Status</label>
            <select class="form-control" name="status">
                <option value="0">WantToPlay</option>
                <option value="1">Playing</option>
                <option value="2">Played</option>
            </select>
        </div>

        <button type="submit" class="btn btn-success mt-2">Save to My List</button>
        <a class="btn btn-outline-secondary mt-2" asp-controller="UserGameLists" asp-action="Index">Go to My List</a>
    </form>
}

<h4>Reviews</h4>

@if (Model.Reviews.Count == 0)
{
    <p>No reviews yet.</p>
}
else
{
    <ul>
        @foreach (var r in Model.Reviews)
        {
            <li>
                <strong>Rating:</strong> @r.Rating/10
                @if (!string.IsNullOrWhiteSpace(r.Text))
                {
                    <div>@r.Text</div>
                }
                <small>@r.CreatedAt.ToLocalTime()</small>
            </li>
        }
    </ul>
}

@if (User.Identity?.IsAuthenticated == true)
{
    <hr />
    <h4>Add / Update your review</h4>

    <form asp-action="AddReview" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="gameId" value="@Model.Game.Id" />

        <div class="form-group">
            <label>Rating (1-10)</label>
            <input class="form-control" type="number" name="rating" min="1" max="10" value="8" required />
        </div>

        <div class="form-group">
            <label>Text</label>
            <textarea class="form-control" name="text" rows="4" maxlength="2000"></textarea>
        </div>

        <button type="submit" class="btn btn-primary mt-2">Save review</button>
    </form>
}
else
{
    <p><em>Log in to add a review.</em></p>
}

